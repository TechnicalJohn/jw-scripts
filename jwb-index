#!/usr/bin/env python3
import argparse
import jwlib.arguments
import jwlib.parse
import jwlib.output


parser = argparse.ArgumentParser(prog='jwb-index.py',
                                 usage='%(prog)s [options] [DIR]',
                                 description='Index or download media from tv.jw.org')

jwlib.arguments.add_arguments(parser, ['--quiet',
                                       '--clean',
                                       '--mode',
                                       '--lang',
                                       '--quality',
                                       '--category',
                                       '--latest',
                                       '--subtitles',
                                       '--no-subtitles',
                                       '--download',
                                       '--limit-rate',
                                       '--checksum',
                                       '--since',
                                       '--no-checksum',
                                       '_work_dir'])
# TODO
#parser.add_argument('--config')

jwb = jwlib.parse.JWBroadcasting()
parser.parse_args(namespace=jwb)

# jwb.mode and jwb.work_dir gets set by argparse
wd = jwb._work_dir
sd = 'jwb-' + jwb.lang

if jwb._mode == 'stdout':
    output = jwlib.output.OutputStdout(wd)

elif jwb._mode == 'm3u':
    output = jwlib.output.OutputM3U(wd, sd)

elif jwb._mode == 'm3ucompat':
    output = jwlib.output.OutputM3UCompat(wd, sd)

elif jwb._mode == 'filesystem':
    output = jwlib.output.OutputFilesystem(wd, sd)
    output.clean_symlinks()

elif jwb._mode == 'html':
    output = jwlib.output.OutputHTML(wd, sd)


# Note:
# output cannot be anything else, argparse takes care of that


jwb.parse(output)

