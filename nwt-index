#!/usr/bin/env python3
import argparse
import jwlib.arguments
import jwlib.parse
import jwlib.output


parser = argparse.ArgumentParser(prog='nwt-index.py',
                                 usage='%(prog)s [options] [DIR]',
                                 description='Index or download sound recordings from jw.org')

jwlib.arguments.add_arguments(parser, ['--quiet',
                                       '--mode',
                                       '--lang',
                                       '--download',
                                       '--limit-rate',
                                       'work_dir'])
# TODO
# parser.add_argument('--config')
parser.add_argument('--book',
                    type=int,
                    metavar='NUM',
                    help='bible book to index')
parser.add_argument('--pub',
                    metavar='CODE',
                    help='publication to index')
parser.add_argument('--silver',
                    action='store_const',
                    const='nwt',
                    dest='pub',
                    help='index the 2013 revised NWT')

jw = jwlib.parse.JWPubMedia()
parser.parse_args(namespace=jw)

# jwb.mode and jwb.work_dir gets set by argparse
wd = jw.work_dir
sd = jw.pub + '-' + jw.lang

if jw.mode == 'stdout':
    output = jwlib.output.OutputStdout(wd)

elif jw.mode == 'm3u':
    output = jwlib.output.OutputM3U(wd, sd)

elif jw.mode == 'm3ucompat':
    output = jwlib.output.OutputM3UCompat(wd, sd)

elif jw.mode == 'filesystem':
    output = jwlib.output.OutputFilesystem(wd, sd)
    output.clean_symlinks()

elif jw.mode == 'html':
    output = jwlib.output.OutputHTML(wd, sd)

# Note:
# output cannot be anything else, argparse takes care of that


jw.parse(output)